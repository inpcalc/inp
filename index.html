<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calcul de moyenne</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .matiere {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 400px;
            position: relative;
        }
        .bouton-ajouter {
            margin-top: 5px;
        }
        .controle {
            margin-top: 5px;
            font-size: 0.9em;
        }
        .controle input[type="checkbox"] {
            margin-right: 5px;
        }
        .coef {
            font-weight: bold;
            display: none;
        }
        .notes-hidden input {
            display: none;
        }
    </style>
</head>
<body>

<h1>Calcul de moyenne</h1>

<!-- Exemple pour Maths, le reste sera similaire -->
<div class="matiere" data-coef="7">
    <h3>Maths <span class="coef">(coef 7)</span></h3>

    <!-- Barre de contrôle -->
    <div class="controle">
        <label><input type="checkbox" class="toggle-coef"> Afficher coefficients</label>
        <label><input type="checkbox" class="toggle-notes"> Masquer notes</label>
        <button class="supprimer">Tout supprimer</button>
    </div>

    <strong>DS</strong>
    <div id="maths-controles">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('maths-controles')" style="display:none;">+</button>

    <br><br>

    <strong>Tests</strong>
    <div id="maths-tests">
        <input type="number" min="0" max="5">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('maths-tests')" style="display:none;">+</button>
</div>

<!-- Exemple Physique -->
<div class="matiere" data-coef="7">
    <h3>Physique <span class="coef">(coef 7)</span></h3>
    <div class="controle">
        <label><input type="checkbox" class="toggle-coef"> Afficher coefficients</label>
        <label><input type="checkbox" class="toggle-notes"> Masquer notes</label>
        <button class="supprimer">Tout supprimer</button>
    </div>
    <div id="physique">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('physique')" style="display:none;">+</button>
</div>

<!-- Répéter pour Chimie, Biologie, Info, Culture G, LV2, Anglais, Sport -->

<button onclick="calculerMoyenne()">Calculer la moyenne générale</button>

<h2 id="resultat"></h2>

<script>
    // --- Fonction pour ajouter une note ---
    function ajouterNote(matiereId) {
        let div = document.getElementById(matiereId);
        let inputs = div.querySelectorAll("input");
        let dernierInput = inputs[inputs.length - 1];

        if (dernierInput.value === "") return; // rien si vide

        let input = document.createElement("input");
        input.type = "number";
        input.min = 0;
        input.max = 20;

        div.appendChild(document.createElement("br"));
        div.appendChild(input);

        majBouton(div); // Mettre à jour le bouton
    }

    // --- Fonction moyenne ---
    function moyenneMatiere(matiereId) {
        let inputs = document.querySelectorAll(`#${matiereId} input`);
        let somme = 0;
        let count = 0;

        inputs.forEach(input => {
            let val = Number(input.value);
            if (!isNaN(val)) {
                somme += val;
                count++;
            }
        });

        return count > 0 ? somme / count : 0;
    }

    function moyenneMaths() {
        let moyenneControles = moyenneMatiere("maths-controles");
        let moyenneTests = moyenneMatiere("maths-tests");
        return (moyenneControles + (moyenneTests / 6)) / (1 + 1/6);
    }

    function calculerMoyenne() {
        let moyenneGenerale = (
            7 * moyenneMaths() +
            7 * moyenneMatiere("physique") +
            4 * moyenneMatiere("chimie") +
            3 * moyenneMatiere("biologie") +
            3 * moyenneMatiere("info") +
            1.5 * moyenneMatiere("cultureg") +
            1.5 * moyenneMatiere("LV2") +
            1.5 * moyenneMatiere("anglais") +
            1.5 * moyenneMatiere("sport")
        ) / 30;

        document.getElementById("resultat").textContent =
            "Moyenne générale : " + moyenneGenerale.toFixed(2);
    }

    // --- Masquer le bouton + tant qu'il n'y a pas de valeur ---
    function majBouton(div) {
        let inputs = div.querySelectorAll("input");
        let dernierInput = inputs[inputs.length - 1];
        let bouton = div.nextElementSibling; // bouton + directement après div

        if (dernierInput.value !== "") {
            bouton.style.display = "inline-block";
        } else {
            bouton.style.display = "none";
        }
    }

    // --- Événements pour chaque matière ---
    document.querySelectorAll(".matiere").forEach(matiere => {
        // Mise à jour bouton + à chaque changement
        matiere.querySelectorAll("input").forEach(input => {
            input.addEventListener("input", () => majBouton(input.parentNode));
        });

        // Afficher coefficients
        let toggleCoef = matiere.querySelector(".toggle-coef");
        toggleCoef.addEventListener("change", () => {
            matiere.querySelector(".coef").style.display = toggleCoef.checked ? "inline" : "none";
        });

        // Masquer / afficher notes
        let toggleNotes = matiere.querySelector(".toggle-notes");
        toggleNotes.addEventListener("change", () => {
            let notesDivs = matiere.querySelectorAll("div[id]");
            notesDivs.forEach(div => div.classList.toggle("notes-hidden", toggleNotes.checked));
        });

        // Tout supprimer
        let supprimerBtn = matiere.querySelector(".supprimer");
        supprimerBtn.addEventListener("click", () => {
            if (confirm("Voulez-vous vraiment supprimer toutes les notes ?")) {
                matiere.querySelectorAll("input").forEach(input => input.value = "");
                matiere.querySelectorAll("br").forEach(br => br.remove());
                matiere.querySelectorAll(".bouton-ajouter").forEach(b => b.style.display = "none");
            }
        });
    });
</script>

</body>
</html>
