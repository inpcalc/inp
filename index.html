<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calcul de moyenne en temps rÃ©el</title>
<style>
body { font-family: Arial, sans-serif; background:white; transition: background 0s; }
.global-controls { margin-bottom: 20px; display: flex; align-items: center; flex-wrap: wrap; gap:10px; opacity:1; transition: opacity 0.2s; }
.global-controls button, .global-controls label { margin-right: 10px; cursor: pointer; }
#matieres-container { display: flex; flex-direction: column; gap: 20px; flex-wrap: wrap; }
.matiere { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; box-sizing:border-box; opacity:1; transition: opacity 0.2s; }
.matiere input { margin-top: 5px; }
.bouton-ajouter, .bouton-supprimer { margin-top: 5px; margin-right: 5px; display:none; }
.coef { font-weight: bold; display: none; }
.nb-notes { font-weight: normal; color: #555; display: none; margin-left: 5px; }
.notes-hidden input { display: none !important; }
.notes-hidden .label-ds, .notes-hidden .label-tests { display: none !important; }
.compteur { font-size: 0.9em; color: #555; margin-left: 10px; }
.display-btn { padding:5px 10px; border:1px solid #ccc; background:#f0f0f0; margin-right:5px; cursor:pointer; }
.display-btn.active { background:#ccc; }
h1 { opacity:1; transition: opacity 0.2s; }
@media (min-width: 1200px) {
  #matieres-container { flex-direction: row; justify-content: flex-start; }
  .matiere { width: calc(25% - 20px); } /* 4 par ligne */
}
@media (min-width: 900px) and (max-width: 1199px) {
  .matiere { width: calc(33% - 20px); } /* 3 par ligne */
}
@media (min-width: 600px) and (max-width: 899px) {
  .matiere { width: calc(50% - 20px); } /* 2 par ligne */
}
@media (max-width: 599px) {
  .matiere { width: 100%; } /* 1 par ligne */
}
</style>
</head>
<body>

<h1 id="titre-principal">Calcul de moyenne</h1>

<div class="global-controls" id="global-controls">
    <label><input type="checkbox" id="toggle-coefs"> Coeffs</label>
    <label><input type="checkbox" id="toggle-nb-notes"> Nb notes</label>
    <label><input type="checkbox" id="toggle-notes"> Masquer</label>
    <button id="supprimer-tout">Tout supprimer</button>
    <label><input type="checkbox" id="toggle-bg"> Couleur</label>
    <span>
        <span id="btn-ligne" class="display-btn active">Ligne</span>
        <span id="btn-grille" class="display-btn">Grille</span>
    </span>
</div>

<div id="matieres-container"></div>

<h2 id="resultat"></h2>

<script>
const matieres = [
    {nom:"Maths", coef:7, id:"maths", ds:true, tests:true},
    {nom:"Physique", coef:7, id:"physique"},
    {nom:"Chimie", coef:4, id:"chimie"},
    {nom:"Biologie", coef:3, id:"biologie"},
    {nom:"Info", coef:3, id:"info"},
    {nom:"Culture G", coef:1.5, id:"cultureg"},
    {nom:"LV2", coef:1.5, id:"LV2"},
    {nom:"Anglais", coef:1.5, id:"anglais"},
    {nom:"Sport", coef:1.5, id:"sport"}
];

const container = document.getElementById("matieres-container");

// --- GÃ©nÃ©ration des matiÃ¨res ---
matieres.forEach(m=>{
    const div = document.createElement("div");
    div.className="matiere";
    div.id=m.id;
    div.dataset.coef=m.coef;

    let html=`<h3>${m.nom} <span class="coef">(coef ${m.coef})</span> <span class="nb-notes">[0]</span></h3>`;
    if(m.ds){
        html+=`<strong class="label-ds">DS</strong>
               <div id="${m.id}-controles"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-controles')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-controles')">ðŸ—‘</button>
               <br><br>
               <strong class="label-tests">Tests</strong>
               <div id="${m.id}-tests"><input type="number" min="0" max="5"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-tests')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-tests')">ðŸ—‘</button>`;
    } else {
        html+=`<div id="${m.id}-notes"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-notes')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-notes')">ðŸ—‘</button>`;
    }
    div.innerHTML=html;
    container.appendChild(div);
});

// --- Ajouter / supprimer notes ---
function ajouterNote(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    const last=inputs[inputs.length-1];
    if(last.value==="") return;
    const input=document.createElement("input");
    input.type="number";
    input.min=0;
    input.max=id.includes("tests")?5:20;
    div.appendChild(document.createElement("br"));
    div.appendChild(input);
    majCompteur(div);
    majMoyenne(); 
    majBoutons(div);
}

function supprimerDerniere(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    if(inputs.length<=1){inputs[0].value="";} 
    else {div.removeChild(inputs[inputs.length-1].previousSibling); div.removeChild(inputs[inputs.length-1]);}
    majCompteur(div);
    majMoyenne();
    majBoutons(div);
}

// --- Boutons visibles uniquement si au moins une note ---
function majBoutons(div){
    const inputs=div.querySelectorAll("input");
    const boutons=div.querySelectorAll(".bouton-ajouter, .bouton-supprimer");
    let anyFilled=false;
    inputs.forEach(i=>{if(i.value!=="") anyFilled=true;});
    boutons.forEach(b=>b.style.display=anyFilled?"inline-block":"none");
}

// --- Compteur ---
function majCompteur(div){
    const compteur = div.parentNode.querySelector(".nb-notes");
    const inputs = div.querySelectorAll("input");
    let nb=0;
    inputs.forEach(i=>{if(i.value!=="") nb++;});
    compteur.textContent=`[${nb}]`;
}

// --- Moyennes ---
function moyenneMatiere(id){
    const inputs=document.querySelectorAll(`#${id} input`);
    let somme=0,count=0;
    inputs.forEach(i=>{ const v=Number(i.value); if(!isNaN(v)) {somme+=v; count++;} });
    return count>0?somme/count:0;
}
function moyenneMaths(){
    const mCont=moyenneMatiere("maths-controles");
    const mTests=moyenneMatiere("maths-tests");
    return (mCont + mTests/6)/(1+1/6);
}
function majMoyenne(){
    let mg=7*moyenneMaths()+
           7*moyenneMatiere("physique-notes")+
           4*moyenneMatiere("chimie-notes")+
           3*moyenneMatiere("biologie-notes")+
           3*moyenneMatiere("info-notes")+
           1.5*moyenneMatiere("cultureg-notes")+
           1.5*moyenneMatiere("LV2-notes")+
           1.5*moyenneMatiere("anglais-notes")+
           1.5*moyenneMatiere("sport-notes");
    mg/=30;
    const resElt=document.getElementById("resultat");
    resElt.textContent="Moyenne gÃ©nÃ©rale : "+mg.toFixed(2);
    resElt.style.display="block";
    if(document.getElementById("toggle-bg").checked) colorerFondGlobal(mg);
}

// --- Boutons globaux ---
document.getElementById("toggle-coefs").addEventListener("change",function(){
    document.querySelectorAll(".coef").forEach(c=>c.style.display=this.checked?"inline":"none");
});
document.getElementById("toggle-nb-notes").addEventListener("change",function(){
    document.querySelectorAll(".nb-notes").forEach(c=>c.style.display=this.checked?"inline":"none");
});

// Masquer / Afficher
document.getElementById("toggle-notes").addEventListener("change",function(){
    const hide=this.checked;
    this.parentNode.textContent=hide?"Afficher":"Masquer";
    const opBloc=hide?0.4:1;
    const titre=document.getElementById("titre-principal");
    titre.style.opacity=hide?0.6:1;
    document.getElementById("global-controls").style.opacity=opBloc;
    document.querySelectorAll(".matiere").forEach(d=>{
        d.classList.toggle("notes-hidden",hide);
        d.style.opacity=opBloc;
        d.style.height="auto";
    });
    document.getElementById("resultat").style.display=hide?"none":"block";
    if(hide) document.body.style.background="white";
});

// Supprimer tout
document.getElementById("supprimer-tout").addEventListener("click",function(){
    document.querySelectorAll(".matiere div[id] input").forEach(i=>i.value="");
    document.querySelectorAll(".matiere div[id] br").forEach(br=>br.remove());
    document.querySelectorAll(".nb-notes").forEach(c=>c.textContent="[0]");
    document.querySelectorAll(".bouton-ajouter, .bouton-supprimer").forEach(b=>b.style.display="none");
    document.getElementById("resultat").textContent="";
    document.body.style.background="white";
});

// --- Couleur instantanÃ©e ---
function colorerFondGlobal(moyenne){
    moyenne=Math.max(0,Math.min(20,moyenne));
    let r,g,b;
    if(moyenne<=10){
        let t=moyenne/10;
        r=Math.round(255*(1-t));
        g=Math.round(255*t);
        b=0;
    } else {
        let t=(moyenne-10)/10;
        r=0;
        g=Math.round(255*(1-t));
        b=Math.round(255*t);
    }
    document.body.style.background=`rgb(${r},${g},${b})`;
}

// --- Affichage Ligne / Grille (boutons exclusifs) ---
const btnLigne=document.getElementById("btn-ligne");
const btnGrille=document.getElementById("btn-grille");
btnLigne.addEventListener("click",()=>{
    btnLigne.classList.add("active");
    btnGrille.classList.remove("active");
    container.style.flexDirection="column";
    container.style.flexWrap="nowrap";
    container.querySelectorAll(".matiere").forEach(m=>m.style.width="400px");
});
btnGrille.addEventListener("click",()=>{
    btnGrille.classList.add("active");
    btnLigne.classList.remove("active");
    container.style.flexDirection="row";
    container.style.flexWrap="wrap";
    container.querySelectorAll(".matiere").forEach(m=>m.style.width="calc(25% - 20px)"); 
});

// --- Initialisation des compteurs et boutons visibles ---
document.querySelectorAll(".matiere div[id]").forEach(div=>{
    div.querySelectorAll("input").forEach(i=>i.addEventListener("input",()=>{
        majCompteur(div);
        majMoyenne();
        majBoutons(div);
    }));
    majCompteur(div);
    majBoutons(div);
});
</script>

</body>
</html>
